    <body>
        <div class="layui-fluid">
            <div class="layui-row layui-col-space15">
                <div class="layui-col-md12">
                  <fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
                    <legend>修改房源</legend>
                  </fieldset>
                  <form id="form" class="layui-form layui-form-pane" action="">
                    <input type="hidden" name="uuid" value="{$info['uuid']}">
                    <div class="layui-col-md6" style="padding: 7.5px;">
                      <div class="layui-card">
                          <div class="layui-card-header">房源基本信息</div>
                          <div class="layui-card-body layui-row layui-col-space10"> 
                              <div class="layui-card-body">
                                <div class="layui-form-item">
                                    <label class="layui-form-label">选择项目</label>
                                    <div class="layui-input-block">
                                        <select name="xiangmuID" lay-verify="required" lay-search="">
                                        <option value="">直接选择或搜索选择项目</option>
                                        {foreach $project as $key=>$vo } 
                                            <option value="{$vo.id}" {eq name="$vo.id"  value="$info['xiangmuID']" } selected="" {/eq}>{$vo.projectName}</option>
                                        {/foreach} 
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">选择小区</label>
                                    <div class="layui-input-block">
                                        <select name="xiaoquID" lay-verify="required" lay-search="">
                                        <option value="">直接选择或搜索选择小区</option>
                                        <!-- <option value="1">layer</option>
                                        <option value="2">form</option> -->
                                        {foreach $xiaoqu as $key=>$vo } 
                                            <option value="{$vo.id}"  {eq name="$vo.id" value="$info['xiaoquID']" } selected="" {/eq}>{$vo.communityName}</option>
                                        {/foreach} 
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="layui-form-item" pane="">
                                    <label class="layui-form-label">持有方式</label>
                                    <div class="layui-input-block" id="isclas">
                                        <input type="radio" name="cyfs" value="1" title="收租" lay-filter="clik"
                                        {eq name="$info['cyfs']"  value="1" } checked="" {/eq}
                                        >
                                        <input type="radio" name="cyfs" value="0" title="自持" lay-filter="clik"
                                        {eq name="$info['cyfs']"  value="0" } checked="" {/eq}
                                        >
                                    </div>
                                </div>
                                <div class="layui-form-item" pane="">
                                    <label class="layui-form-label">出租方式</label>
                                    <div class="layui-input-block" id="isclas">
                                        <input type="radio" name="clas" value="1" title="整租" lay-filter="clik"
                                        {eq name="$info['chuzutype']"  value="1" } checked="" {/eq}
                                        >
                                        <input type="radio" name="clas" value="0" title="合租" lay-filter="clik"
                                        {eq name="$info['chuzutype']"  value="0" } checked="" {/eq}
                                        >
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">栋(楼号)</label>
                                    <div class="layui-input-inline">
                                        <input type="text" name="dong" lay-verify="number" value="{$info.dong}" placeholder="栋" autocomplete="off" class="layui-input">
                                    </div>
                                    <div class="layui-form-mid layui-word-aux">栋</div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">单元号</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="danyuan" placeholder="(选填)" value="{$info.danyuan}" autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">楼层</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="ceng" lay-verify="number" value="{$info.ceng}" placeholder="(选填)" autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">房屋面积</label>
                                    <div class="layui-input-inline">
                                        <input type="text" name="mianji" lay-verify="number" value="{$info.mianji}" placeholder="面积" autocomplete="off" class="layui-input">
                                    </div>
                                    <div class="layui-form-mid layui-word-aux">/㎡</div>
                                </div>
                                <div class="layui-form-item" pane="">
                                    <label class="layui-form-label">房屋类型</label>
                                    <div class="layui-input-block">
                                        {foreach $house_state as $key=>$vo } 
                                            {if condition="$key == 0"} 
                                            <input type="radio" name="fangwutype" value="{$vo.keys}" title="{$vo.keys}"
                                            {eq name="$info['fangwutype']"  value="$vo.keys" } checked="" {/eq}
                                            >
                                            {else/} 
                                            <input type="radio" name="fangwutype" value="{$vo.keys}" title="{$vo.keys}"
                                            {eq name="$info['fangwutype']"  value="$vo.keys" } checked="" {/eq}
                                            >
                                            {/if} 
                                        {/foreach} 
                                    </div>

                                </div>
                                <div class="layui-form-item layui-form-text">
                                    <label class="layui-form-label">房源备注</label>
                                    <div class="layui-input-block">
                                        <textarea placeholder="请输入备注内容" class="layui-textarea" name="beizhu">{$info.beizhu}</textarea>
                                    </div>
                                </div>
                              </div>
                          </div>
                      </div>
                    </div>
                    <div class="layui-col-md6" style="padding: 7.5px;">
                      <div class="layui-card">
                          <div class="layui-card-header">房源 -- 附加房间信息</div>
                          <input type="hidden" name="room[0][room_id]" value="{$info.room[0]['room_id']}">
                          <div class="layui-card-body layui-row layui-col-space10"> 
                              <div class="layui-card-body">
                                <div class="layui-form-item">
                                    <label class="layui-form-label">房间编号</label>
                                    <div class="layui-input-inline">
                                        <input type="text" name="room[0][fjbh]" value="{$info.room[0]['fjbh']}" lay-verify="required" placeholder="房间编号" autocomplete="off" class="layui-input">
                                    </div>
                                    <div class="layui-form-mid layui-word-aux"> <i class="layui-icon layui-icon-tips"  style="padding-left: 10px;padding-right: 0px;"> </i> <span>合租房命名：建议使用房号加字母，如：301A、301B、301C</span> </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">房间面积</label>
                                    <div class="layui-input-inline">
                                        <input type="text" name="room[0][fjarea]" lay-verify="number" value="{$info.room[0]['fjarea']}" placeholder="房间面积" autocomplete="off" class="layui-input">
                                    </div>
                                    <div class="layui-form-mid layui-word-aux">/㎡</div>
                                </div>
                                <div class="layui-form-item" pane="">
                                    <label class="layui-form-label">房间状态</label>
                                    <div class="layui-input-block" id="isfjstatus">
                                        <input type="radio" name="room[0][fjstatus]" value="10" title="在租" lay-filter="clik" disabled="disabled">
                                        <input type="radio" name="room[0][fjstatus]" value="11" {eq name="$info.room[0]['fjstatus']"  value="11" } checked="" {/eq} title="空置" lay-filter="clik" checked="">
                                        <input type="radio" name="room[0][fjstatus]" value="12" {eq name="$info.room[0]['fjstatus']"  value="12" } checked="" {/eq} title="装修" lay-filter="clik">
                                        <input type="radio" name="room[0][fjstatus]" value="13" title="预定" lay-filter="clik" disabled="disabled">
                                    </div>
                                </div>
                                <div class="layui-form-item layui-form-text">
                                    <label class="layui-form-label">房间备注</label>
                                    <div class="layui-input-block">
                                        <textarea placeholder="请输入备注内容" class="layui-textarea" name="room[0][beizhu]">{$info.room[0]['beizhu']}</textarea>
                                    </div>
                                </div>
                                <fieldset class="layui-elem-field addroomlist">
                                    <legend>其他房间信息</legend>
                                    <div class="layui-field-box listInput">
                                        {volist name="$info.room" id="vo" offset="1"}
                                        <fieldset class="layui-elem-field isroomnum">
                                          <legend class="dels" style="color: red;margin-left:50px;font-size: 16px;cursor: pointer;">删除</legend>
                                          <input type="hidden" name="room[{$key}][room_id]" value="{$vo['room_id']}">
                                          <div class="layui-field-box">
                                              <div class="layui-form-item">
                                                  <label class="layui-form-label">房间编号</label>
                                                  <div class="layui-input-inline">
                                                      <input type="text" name="room[{$key}][fjbh]" value="{$vo.fjbh}" lay-verify="required" placeholder="房间编号" autocomplete="off" class="layui-input">
                                                  </div>
                                                  <div class="layui-form-mid layui-word-aux"> <i class="layui-icon layui-icon-tips"  style="padding-left: 10px;padding-right: 0px;"> </i> <span>合租房命名：建议使用房号加字母，如：301A、301B、301C</span> </div>
                                              </div>
                                              <div class="layui-form-item">
                                                  <label class="layui-form-label">房间面积</label>
                                                  <div class="layui-input-inline">
                                                      <input type="text" name="room[{$key}][fjarea]" value="{$vo.fjarea}" lay-verify="number" placeholder="房间面积" autocomplete="off" class="layui-input">
                                                  </div>
                                                  <div class="layui-form-mid layui-word-aux">/㎡</div>
                                              </div>
                                              <div class="layui-form-item" pane="">
                                                  <label class="layui-form-label">房间状态</label>
                                                  <div class="layui-input-block" id="isfjstatus">
                                                      <input type="radio" name="room[{$key}][fjstatus]" value="10" title="在租" lay-filter="clik" disabled>
                                                      <input type="radio" name="room[{$key}][fjstatus]" value="11" title="空置" {eq name="$vo['fjstatus']"  value="12" } checked="" {/eq} lay-filter="clik" checked="">
                                                      <input type="radio" name="room[{$key}][fjstatus]" value="12" title="装修" {eq name="$vo['fjstatus']"  value="12" } checked="" {/eq} lay-filter="clik">
                                                      <input type="radio" name="room[{$key}][fjstatus]" value="13" title="预定" lay-filter="clik" disabled>
                                                  </div>
                                              </div>
                                              <div class="layui-form-item layui-form-text">
                                                  <label class="layui-form-label">房间备注</label>
                                                  <div class="layui-input-block">
                                                      <textarea placeholder="请输入备注内容" class="layui-textarea" name="room[{$key}][beizhu]">{$vo.beizhu}</textarea>
                                                  </div>
                                              </div>
                                          </div>
                                        </fieldset>
                                        {/volist}
                                    </div>
                                </fieldset>
                                <div class="layui-form-item roomadd">
                                    <button id="roomadd" type="button" class="layui-btn layui-btn-primary layui-btn-radius" data-type="adds">+ 增加一间房间信息</button>
                                </div>
                              </div>
                          </div>
                      </div>
                    </div>
                    <div class="layui-col-md12" style="padding: 7.5px;">
                      <div class="layui-card">
                        <div class="layui-card-body layui-row layui-col-space10" style="text-align: center;"> 
                          <button lay-submit="" lay-filter="subs" id="subs" type="button" class="layui-btn layui-btn-primary layui-btn-radius" data-type="adds" style="background-color: #009688;color: white;">+ 立即修改房源</button>
                        </div>
                      </div>  
                    </div>
                  </form>
                </div>
            </div>
        </div>
        <script src="__INDEX__/layuiadmin/layui/layui.js"></script>
        <script>
            layui.config({
                base: '__INDEX__/layuiadmin/' //静态资源所在路径
            }).extend({
                index: 'lib/index' //主入口模块
            }).use(['form','laydate','index', 'upload'],function(){
                var laydate = layui.laydate;
                var $ = layui.$
                , layer = layui.layer
                ,upload = layui.upload
                ,form = layui.form;
                // element.render();
                
                // 租赁时间区间选择 -------- start
                laydate.render({
                  elem: '#test-laydate-format-range2'
                  ,range: '~'
                });
                // 租赁时间区间选择 -------end
                // 
                // 
                //点击新增一间房间信息 ------- start
                $('.roomadd #roomadd').on('click', function(){
                  var numbers = $('.isroomnum').length;
                  var index = numbers + 1;
                  var html = '<fieldset class="layui-elem-field isroomnum">\
                                  <legend class="dels" style="color: red;margin-left:50px;font-size: 16px;cursor: pointer;">删除</legend>\
                                  <div class="layui-field-box">\
                                      <div class="layui-form-item">\
                                          <label class="layui-form-label">房间编号</label>\
                                          <div class="layui-input-inline">\
                                              <input type="text" name="room['+index+'][fjbh]" lay-verify="required" placeholder="房间编号" autocomplete="off" class="layui-input">\
                                          </div>\
                                          <div class="layui-form-mid layui-word-aux"> <i class="layui-icon layui-icon-tips"  style="padding-left: 10px;padding-right: 0px;"> </i> <span>合租房命名：建议使用房号加字母，如：301A、301B、301C</span> </div>\
                                      </div>\
                                      <div class="layui-form-item">\
                                          <label class="layui-form-label">房间面积</label>\
                                          <div class="layui-input-inline">\
                                              <input type="text" name="room['+index+'][fjarea]" lay-verify="number" placeholder="房间面积" autocomplete="off" class="layui-input">\
                                          </div>\
                                          <div class="layui-form-mid layui-word-aux">/㎡</div>\
                                      </div>\
                                      <div class="layui-form-item" pane="">\
                                          <label class="layui-form-label">房间状态</label>\
                                          <div class="layui-input-block" id="isfjstatus">\
                                              <input type="radio" name="room['+index+'][fjstatus]" value="10" title="在租" lay-filter="clik" disabled>\
                                              <input type="radio" name="room['+index+'][fjstatus]" value="11" title="空置" lay-filter="clik" checked="">\
                                              <input type="radio" name="room['+index+'][fjstatus]" value="12" title="装修" lay-filter="clik">\
                                              <input type="radio" name="room['+index+'][fjstatus]" value="13" title="预定" lay-filter="clik" disabled>\
                                          </div>\
                                      </div>\
                                      <div class="layui-form-item layui-form-text">\
                                          <label class="layui-form-label">房间备注</label>\
                                          <div class="layui-input-block">\
                                              <textarea placeholder="请输入备注内容" class="layui-textarea" name="room['+index+'][beizhu]"></textarea>\
                                          </div>\
                                      </div>\
                                  </div>\
                              </fieldset>';

                  if(numbers >= 6){
                      layer.msg('最多新增六个房间！', {icon: 5});
                      return false;
                  }else{
                      $('.listInput').append(html);
                      $(".addroomlist").show();
                      form.render();
                  }
                  
              });
              

              $(document).on("click",".dels",function(){
                  var numbers = $('.isroomnum').length;
                  var objs = $(this);
                  layer.confirm('是否取消新增房间？', {
                      btn: ['确定','取消'] //按钮
                  }, function(){
                      if(numbers == 1){
                          objs.parent().remove();
                          $(".addroomlist").hide();
                      }else{
                          objs.parent().remove();
                      }
                      layer.msg('已取消修改', {icon: 1});
                  }, function(){
                      // layer.msg('已取消', {
                      //     time: 1000
                      // });
                  }); 
              })
              //点击新增一间房间信息 ------- end
              //
              //
              // 监听表单提交 -------- start
              form.on('submit(subs)', function(data){
                // $('#subs').attr('disabled','disabled');
                var form = $("#form").serializeArray();

                $.post({
                    url: '{:url("edit")}',
                    data: form
                    ,success: function(res) {
                        if(res.code == 1 ){
                          //登入成功的提示与跳转
                          layer.msg(res.msg, {
                            offset: '15px'
                            ,icon: 1
                            ,time: 1000
                          }, function(){
                            //刷新当前
                            location.href = "{:url('edit', ['uuid' => $info.uuid])}";

                          });
                        }else{
                          layer.msg(res.msg, {
                            offset: '15px'
                            ,icon: 5
                            ,time: 1000
                          }, function(){
                            //刷新当前
                          });
                        }
                    }
                    ,error: function(res) {
                        layer.msg('系统繁忙，请稍后再试', {
                          offset: '15px'
                          ,icon: 5
                          ,time: 1000
                        });
                    }
                });
                
                // return false;
              }); 
              // 监听表单提交 -------- end
            })
      </script>
    </body>
    

</html>